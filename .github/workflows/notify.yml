name: Karuta Timer Notify ðŸŒ¸

on:
  schedule:
    - cron: "*/35 * * * *"  # toutes les 35 minutes

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: VÃ©rifie l'heure et la pause
        id: check_time
        run: |
          # Heure locale UTC+2
          HOUR=$(date -u +%H)
          MIN=$(date -u +%M)
          HOUR=$((HOUR + 2))
          if [ $HOUR -ge 24 ]; then
            HOUR=$((HOUR - 24))
          fi
          echo "Heure locale actuelle (UTC+2): $HOUR:$MIN"

          if [ $HOUR -ge 0 ] && [ $HOUR -lt 9 ]; then
            echo "sleep=true" >> $GITHUB_OUTPUT
          else
            echo "sleep=false" >> $GITHUB_OUTPUT

      - name: Envoie notif Discord
        if: steps.check_time.outputs.sleep == 'false'
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          IMAGE_URL="https://raw.githubusercontent.com/${{ github.repository }}/main/assets/mwa.gif"
          FOOTER="Powered by GitHub Actions â€¢ Made with ðŸ’– by Spincka"
          DESC=$'Il est temps de farmer tes cartes, Senpai ! âœ¨\n\nNâ€™oublie pas de taper ta commande Karuta pour rÃ©cupÃ©rer ta carte ! ðŸ’•'

          curl -H "Content-Type: application/json" \
               -d "$(jq -n \
               --arg title "ðŸŒ¸ Karuta Timer" \
               --arg desc "$DESC" \
               --arg image "$IMAGE_URL" \
               --arg footer "$FOOTER" \
               --arg author_name "ðŸŒ¸ KarutaNotifier" \
               --arg author_icon "$IMAGE_URL" \
               '{
                 "embeds": [
                   {
                     "author": {
                       "name": $author_name,
                       "icon_url": $author_icon
                     },
                     "title": $title,
                     "description": $desc,
                     "color": 15548997,
                     "image": {"url": $image},
                     "footer": {"text": $footer}
                   }
                 ]
               }')" \
               $DISCORD_WEBHOOK_URL
