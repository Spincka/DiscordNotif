name: Karuta Timer Notify ðŸŒ¸

on:
  schedule:
    - cron: "*/30 * * * *"
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Envoie notif Discord
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          IMAGE_URL="https://raw.githubusercontent.com/${{ github.repository }}/main/assets/mwa.gif"
          FOOTER="Powered by GitHub Actions â€¢ Made with ðŸ’– by Spincka"
          DESC=$'Il est temps de farmer tes cartes, Senpai ! âœ¨\n\nClique sur le bouton ci-dessous pour relancer le timer. ðŸ’•'

          curl -H "Content-Type: application/json" \
               -d "$(jq -n \
               --arg title "ðŸŒ¸ Karuta Timer" \
               --arg desc "$DESC" \
               --arg image "$IMAGE_URL" \
               --arg footer "$FOOTER" \
               '{
                 "embeds": [
                   {
                     "title": $title,
                     "description": $desc,
                     "color": 15548997,
                     "image": {"url": $image},
                     "footer": {"text": $footer}
                   }
                 ],
                 "components": [
                   {
                     "type": 1,
                     "components": [
                       {
                         "type": 2,
                         "style": 2,
                         "label": "ðŸ’« Relancer le timer",
                         "custom_id": "restart_timer"
                       }
                     ]
                   }
                 ]
               }')" \
               $DISCORD_WEBHOOK_URL
